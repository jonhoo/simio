#
# Clock IO automaton
#

Name:
	Clock

Signature-Input:
	request

Signature-Internal:
	tick

Signature-Output:
	clock(t)

# XXX -- its lame to make the user prepend "self."s everywhere...
State:
	self.counter = 0
	self.flag = False

Transition-Name:
	tick
Transition-Precondition:
	return True
Transition-Effect:
	self.counter += 1

Transition-Name:
	request
Transition-Effect:
	self.flag = True

Transition-Name:
	clock(t)
Transition-Precondition:
	return self.flag == True
Transition-Output:
	return self.counter
Transition-Effect:
	self.flag = False

Tasks:
	tick
	clock(t)

#
# Channel IO automaton
#

Name:
	Channel

Signature-Input:
	send(m) connect

Signature-Output:
	receive(m) connect

State:
	self.queue = []

Transition-Name:
	send(m)
Transition-Effect:
	self.queue.append(m)

Transition-Name:
	receive(m)
Transition-Precondition:
	return len(self.queue) > 0
Transition-Output:
	return self.queue[0]
Transition-Effect:
	self.queue = self.queue[1:]

Tasks:
	receive(m)

